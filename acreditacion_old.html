<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Acreditaciones - Registro de Asistencias</title>
<link rel="icon" href="data:,">
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
:root {
--bg: #ffffff;
--panel: #f8fafc;
--txt: #1f2937;
--ok: #25d366;
--brand: #1e3a8a;
--error: #dc2626;
}
* { box-sizing: border-box; }
body {
margin: 0; padding: 0;
font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, system-ui, sans-serif;
background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
background-attachment: fixed;
color: var(--txt);
min-height: 100vh;
display: flex;
align-items: center;
justify-content: center;
padding: 5%;
overflow-x: hidden;
font-size: 16px;
}
.search-container {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(15px);
border-radius: 1.25em;
box-shadow: 0 0.75em 2.5em rgba(30, 58, 138, 0.15);
border: 1px solid rgba(255, 255, 255, 0.2);
padding: 5%;
max-width: 100%;
width: 390px;
text-align: center;
margin: 0 auto;
transition: all 0.3s ease;
position: relative;
}
.search-container:hover {
box-shadow: 0 16px 50px rgba(30, 58, 138, 0.20);
transform: translateY(-2px);
}
.header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 1.5em;
}
.header-logo {
width: 50%;
max-width: 8em;
height: auto;
aspect-ratio: 1;
object-fit: contain;
filter: drop-shadow(0 0.25em 0.5em rgba(30, 58, 138, 0.15));
}
.logout-btn {
background: var(--error);
color: white;
border: none;
padding: 0.5em 0.8em;
border-radius: 0.375em;
font-size: 0.75em;
cursor: pointer;
transition: all 0.3s ease;
}
.logout-btn:hover {
background: #b91c1c;
transform: translateY(-0.125em);
}
.search-title {
font-size: 1.25em;
font-weight: 700;
color: var(--brand);
margin-bottom: 0.75em;
}
.search-form { margin-bottom: 1em; }
.search-input {
width: 100%;
padding: 0.75em;
border: 2px solid #d1d5db;
border-radius: 0.5em;
font-size: 0.875em;
background: #f3f4f6;
transition: all 0.3s ease;
margin-bottom: 0.75em;
text-align: center;
}
.search-input:focus {
outline: none;
border-color: var(--brand);
box-shadow: 0 0 0 0.1875em rgba(30, 58, 138, 0.2);
background: white;
transform: scale(1.02);
}
.search-btn {
width: 100%;
padding: 0.75em;
background: var(--brand);
color: white;
border: none;
border-radius: 0.5em;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
font-size: 0.875em;
}
.search-btn:hover {
background: #1e40af;
transform: translateY(-0.125em);
box-shadow: 0 0.25em 0.75em rgba(30, 58, 138, 0.3);
}
.search-btn:disabled {
background: #9ca3af;
cursor: not-allowed;
transform: none;
}
.results-section {
margin-top: 1em;
opacity: 0;
max-height: 0;
overflow: hidden;
transition: all 0.4s ease;
border-top: 1px solid #e5e7eb;
padding-top: 0;
}
.results-section.show {
opacity: 1;
max-height: 500px;
padding-top: 1em;
}
.user-card {
background: #f8fafc;
border-radius: 0.75em;
padding: 1em;
margin-bottom: 1em;
text-align: left;
border: 1px solid #e5e7eb;
}
.user-name {
font-size: 1.125em;
font-weight: 700;
color: var(--brand);
margin-bottom: 0.5em;
}
.user-detail {
display: flex;
justify-content: space-between;
align-items: center;
padding: 0.5em 0;
border-bottom: 1px solid #e5e7eb;
}
.user-detail:last-of-type {
border-bottom: none;
margin-bottom: 1em;
}
.detail-label {
font-weight: 600;
color: #4b5563;
font-size: 0.875em;
}
.detail-value {
color: var(--txt);
font-size: 0.875em;
text-align: right;
word-break: break-word;
}
.confirm-btn {
width: 100%;
background: var(--ok);
color: white;
border: none;
padding: 0.875em;
border-radius: 0.5em;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
font-size: 0.875em;
}
.confirm-btn:hover {
background: #22c55e;
transform: translateY(-0.125em);
box-shadow: 0 0.25em 0.75em rgba(34, 197, 94, 0.3);
}
.success-message {
background: #dcfce7;
color: #166534;
padding: 1em;
border-radius: 0.5em;
font-weight: 600;
text-align: center;
margin-top: 1em;
opacity: 0;
transform: translateY(-10px);
transition: all 0.3s ease;
}
.success-message.show {
opacity: 1;
transform: translateY(0);
}
.loading-overlay {
position: absolute;
top: 0; left: 0; right: 0; bottom: 0;
background: rgba(255, 255, 255, 0.9);
display: none;
align-items: center;
justify-content: center;
border-radius: 1.25em;
}
.spinner {
width: 2em; height: 2em;
border: 0.25em solid #f3f4f6;
border-top: 0.25em solid var(--brand);
border-radius: 50%;
animation: spin 1s linear infinite;
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
.status-badge {
padding: 0.25em 0.5em;
border-radius: 0.375em;
font-size: 0.75em;
font-weight: 600;
text-transform: uppercase;
}
.status-present { background: #dcfce7; color: #166534; }
.status-absent { background: #fef2f2; color: #991b1b; }
.error-message {
color: var(--error);
font-size: 0.75em;
margin-top: 0.5em;
opacity: 0;
transition: opacity 0.3s ease;
text-align: center;
}
.error-message.show { opacity: 1; }
@media screen and (max-width: 450px) {
body { padding: 3%; }
.search-container { width: min(390px, 95vw); padding: 6%; }
}
@media screen and (max-width: 350px) {
body { font-size: 14px; }
.header { flex-direction: column; gap: 0.5em; text-align: center; }
}
</style>
</head>
<body>
<div class="search-container">
<div class="loading-overlay" id="loadingOverlay">
<div class="spinner"></div>
</div>
<div class="header">
<img src="LOGO NUEVO COLOR_122003.png" alt="Logo" class="header-logo">
<button class="logout-btn" onclick="logout()">Salir</button>
</div>
<div class="search-title">Buscar Asistente</div>
<form class="search-form" onsubmit="searchUser(event)">
<input type="text" class="search-input" id="searchInput" placeholder="Ingrese cédula o nombre..." required>
<button type="submit" class="search-btn" id="searchBtn">Buscar</button>
</form>
<div class="error-message" id="errorMessage"></div>
<div class="results-section" id="resultsSection">
<div class="user-card" id="userCard">
<div class="user-name" id="userName"></div>
<div class="user-detail">
<span class="detail-label">Cédula:</span>
<span class="detail-value" id="userCedula"></span>
</div>
<div class="user-detail">
<span class="detail-label">Cargo:</span>
<span class="detail-value" id="userCargo"></span>
</div>
<div class="user-detail">
<span class="detail-label">Dependencia:</span>
<span class="detail-value" id="userDependencia"></span>
</div>
<div class="user-detail">
<span class="detail-label">Estado:</span>
<span class="detail-value" id="userEstado"></span>
</div>
<button class="confirm-btn" onclick="confirmAttendance()">Dar Asistencia</button>
</div>
</div>
<div class="success-message" id="successMessage">¡Asistencia registrada exitosamente!</div>
</div>
<script>
const SUPABASE_URL = 'https://pjcokjzxzgefpdmbkuop.supabase.co'
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqY29ranp4emdlZnBkbWJrdW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjgwOTU4MDEsImV4cCI6MjA0MzY3MTgwMX0.m6p56KgGnlqSsJJJYCCqPbYMB6x_FjFyO5R5mRANY5c'
const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
let currentUser = null;
function showError(message) {
const errorDiv = document.getElementById('errorMessage');
errorDiv.textContent = message;
errorDiv.classList.add('show');
setTimeout(() => errorDiv.classList.remove('show'), 5000);
}
function showLoading(show) {
const overlay = document.getElementById('loadingOverlay');
const searchBtn = document.getElementById('searchBtn');
overlay.style.display = show ? 'flex' : 'none';
searchBtn.disabled = show;
}
function clearResults() {
const resultsSection = document.getElementById('resultsSection');
const successMessage = document.getElementById('successMessage');
resultsSection.classList.remove('show');
successMessage.classList.remove('show');
currentUser = null;
}
function showUserResults(user) {
document.getElementById('userName').textContent = user.nombre;
document.getElementById('userCedula').textContent = user.cedula;
document.getElementById('userCargo').textContent = user.cargo || 'No especificado';
document.getElementById('userDependencia').textContent = user.dependencia || 'No especificada';
const statusElement = document.getElementById('userEstado');
const today = new Date().toISOString().split('T')[0];
const hasAttendance = user.attendance && user.attendance.some(a => a.fecha === today && a.presente);
if (hasAttendance) {
statusElement.innerHTML = '<span class="status-badge status-present">Presente</span>';
} else {
statusElement.innerHTML = '<span class="status-badge status-absent">Ausente</span>';
}
document.getElementById('resultsSection').classList.add('show');
currentUser = user;
}
async function searchUser(event) {
event.preventDefault();
const searchInput = document.getElementById('searchInput');
const query = searchInput.value.trim();
if (!query) {
showError('Por favor ingrese un término de búsqueda');
return;
}
clearResults();
showLoading(true);
try {
let { data: users, error } = await _supabase
.from('funcionarios')
.select('*, attendance:asistencias(fecha, presente)')
.or('cedula.eq.' + query + ',nombre.ilike.%' + query + '%')
.limit(1);
if (error) throw error;
if (users && users.length > 0) {
showUserResults(users[0]);
} else {
showError('No se encontró ningún funcionario con ese criterio de búsqueda');
}
} catch (error) {
console.error('Error al buscar:', error);
showError('Error al buscar funcionario: ' + error.message);
} finally {
showLoading(false);
}
}
async function confirmAttendance() {
if (!currentUser) return;
showLoading(true);
try {
const today = new Date().toISOString().split('T')[0];
const now = new Date().toISOString();
let { data: existingAttendance, error: checkError } = await _supabase
.from('asistencias')
.select('*')
.eq('funcionario_id', currentUser.id)
.eq('fecha', today)
.single();
if (checkError && checkError.code !== 'PGRST116') {
throw checkError;
}
if (existingAttendance) {
const { error: updateError } = await _supabase
.from('asistencias')
.update({
presente: true,
hora_entrada: now,
updated_at: now
})
.eq('id', existingAttendance.id);
if (updateError) throw updateError;
} else {
const { error: insertError } = await _supabase
.from('asistencias')
.insert({
funcionario_id: currentUser.id,
fecha: today,
presente: true,
hora_entrada: now,
created_at: now,
updated_at: now
});
if (insertError) throw insertError;
}
document.getElementById('successMessage').classList.add('show');
setTimeout(() => {
clearResults();
document.getElementById('searchInput').value = '';
document.getElementById('searchInput').focus();
}, 2000);
} catch (error) {
console.error('Error al registrar asistencia:', error);
showError('Error al registrar asistencia: ' + error.message);
} finally {
showLoading(false);
}
}
function logout() {
if (confirm('¿Está seguro que desea cerrar sesión?')) {
window.location.href = 'index.html';
}
}
document.addEventListener('DOMContentLoaded', function() {
document.getElementById('searchInput').focus();
});
document.getElementById('searchInput').addEventListener('keypress', function(e) {
if (e.key === 'Enter') {
searchUser(e);
}
});
</script>
</body>
</html>
